<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ABQ Dining Map</title>
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <style>
    :root{
      --bg: #f7f7f8;
      --panel: #ffffff;
      --text: #111418;
      --muted: #6b7280;
      --shadow: 0 8px 30px rgba(0,0,0,.08);
      --radius: 14px;
    }
    html, body { height: 100%; margin: 0; background: var(--bg); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Helvetica, Arial; color: var(--text); }
    #app { display: grid; grid-template-rows: auto 1fr; height: 100vh; }
    header{ display:flex; align-items:center; gap:.75rem; padding: 10px 14px; background: var(--panel); box-shadow: var(--shadow); position: sticky; top: 0; z-index: 1000; }
    .title{ font-weight: 600; letter-spacing:.2px; }
    #map { height: 100%; }

    /* Controls container (top-right) */
    .controls{ position: absolute; top: 12px; right: 12px; display:flex; flex-direction:column; gap:10px; z-index: 1001; }
    .card{ background: var(--panel); border-radius: var(--radius); box-shadow: var(--shadow); padding: 10px; min-width: 260px; max-width: 360px; }
    .card h3{ margin: 0 0 8px 0; font-size: 14px; font-weight: 600; }
    .legend-row{ display:flex; align-items:center; gap:8px; font-size: 13px; padding: 6px 0; }
    .chip{ width: 12px; height: 12px; border-radius: 50%; border:1px solid rgba(0,0,0,.1); }
    .select{ width: 100%; border: 1px solid #e5e7eb; border-radius: 12px; padding: 10px 12px; font-size: 14px; background: #fafafa; }
    .btns{ display:flex; gap:8px; flex-wrap: wrap; }
    .btn{ appearance:none; border: 1px solid #e5e7eb; background: #fff; border-radius: 12px; padding: 8px 12px; font-size: 13px; color: var(--text); cursor: pointer; box-shadow: var(--shadow); }
    .btn.primary{ border-color: #dbeafe; background:#f0f7ff; color:#0b63d1; }
    .btn.success{ border-color:#d1f7df; background:#f4fff7; color:#176b3d; }

    .leaflet-control-attribution{ font-size: 10px; color: var(--muted); }

    /* Popups */
    .popup h4{ margin: 0 0 6px 0; font-size: 15px; }
    .popup .meta{ font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    .popup .row{ font-size: 13px; margin: 2px 0; }
    .popup .row strong{ display:inline-block; width:72px; color:#374151; }
    .hotel-star svg{ filter: drop-shadow(0 2px 4px rgba(0,0,0,.25)); }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2c2.5 4.2 5.3 6.4 8.4 6.5-2.1 6.7-5.5 10.6-8.4 13-2.9-2.4-6.3-6.3-8.4-13C6.7 8.4 9.5 6.2 12 2Z" stroke="#0a84ff" stroke-width="1.2"/></svg>
      <div class="title">ABQ Dining Near DoubleTree</div>
    </header>

    <div style="position:relative;">
      <div id="map"></div>
      <div class="controls">
        <div class="card" id="legendCard">
          <h3>Legend</h3>
          <div class="legend-row"><span class="chip" style="background:#5b93ff"></span> Walking Downtown (0–1 mi)</div>
          <div class="legend-row"><span class="chip" style="background:#8bd46a"></span> Short Drive to Old Town (1–3 mi)</div>
          <div class="legend-row"><span class="chip" style="background:#f3c96b"></span> Quick Adventure (3–5 mi)</div>
          <div class="legend-row"><span class="chip" style="background:#d89ef9"></span> Worth the Drive (5+ mi)</div>
          <div style="margin-top:8px">
            <select id="placeSelect" class="select">
              <option value="">Quick Jump To A Restaurant</option>
            </select>
          </div>
          <div style="margin-top:8px">
            <select id="cuisineSelect" class="select">
              <option value="">Filter by cuisine…</option>
            </select>
          </div>
          <div class="btns" style="margin-top:8px;">
            <button class="btn primary" id="centerHotelBtn">Center on Hotel</button>
            <button class="btn success" id="useLocationBtn">Use My Location</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== Config ======
    const HOTEL = { name: "DoubleTree by Hilton Downtown Albuquerque", lat: 35.088451, lng: -106.649013 };
    const INITIAL_ZOOM = 14;

    const COLORS = {
      "Downtown": "#5b93ff",
      "Old Town & Sawmill": "#8bd46a",
      "Nob Hill & North Valley": "#f3c96b",
      "Worth the Drive": "#d89ef9"
    };

    // ====== Data (with a/p hours) ======
    const PLACES = [
      // Walking Downtown (0–1 mi)
      { area: "Downtown", name: "The Artichoke Café – American", address: "424 Central Ave SE, Albuquerque, NM", distance: "0.5 mi", phone: "(505) 243-0200", hours: "Mon–Thu 11a–9p, Fri–Sat 11a–10p" },
      { area: "Downtown", name: "MAS Tapas y Vino (Hotel Andaluz) – Tapas", address: "125 2nd St NW, Albuquerque, NM", distance: "0.2 mi", phone: "(505) 242-9080", hours: "Daily 7a–10p" },
      { area: "Downtown", name: "Slate Street Café – Café", address: "515 Slate Ave NW, Albuquerque, NM", distance: "0.4 mi", phone: "(505) 243-2210", hours: "Mon–Fri 8a–2p, Sat 9a–2p" },
      { area: "Downtown", name: "Marble Brewery – Brewery", address: "111 Marble Ave NW, Albuquerque, NM", distance: "0.5 mi", phone: "(505) 243-2739", hours: "Daily 11:30a–10p" },
      { area: "Downtown", name: "Range Café Downtown – New Mexican", address: "320 Central Ave SE, Albuquerque, NM", distance: "0.4 mi", phone: "(505) 243-1440", hours: "Daily 7a–3p" },
      { area: "Downtown", name: "505 Central Food Hall – Food Hall", address: "505 Central Ave NW, Albuquerque, NM", distance: "0.3 mi", phone: "Varies by Vendor", hours: "Varies by Vendor | Usually 11a–9p" },

      // Short Drive to Old Town (1–3 mi)
      { area: "Old Town & Sawmill", name: "Cocina Azul – New Mexican", address: "1134 Mountain Rd NW, Albuquerque, NM", distance: "0.7 mi", phone: "(505) 831-2500", hours: "Daily 9a–8p" },
      { area: "Old Town & Sawmill", name: "Kosmos Restaurant & Astropub – American", address: "1715 5th St NW, Albuquerque, NM", distance: "1.2 mi", phone: "(505) 369-1772", hours: "Tue–Thu 11:30a–8p, Fri–Sat 11:30a–9p" },
      { area: "Old Town & Sawmill", name: "Laguna Burger (Old Town) – Burgers", address: "2400 12th St NW, Albuquerque, NM", distance: "2.0 mi", phone: "(505) 352-8282", hours: "Daily 10:30a–8p" },
      { area: "Old Town & Sawmill", name: "Indian Pueblo Kitchen – Native American", address: "2401 12th St NW, Albuquerque, NM", distance: "2.1 mi", phone: "(505) 724-3510", hours: "Wed–Sun 8a–3p" },
      { area: "Old Town & Sawmill", name: "Sawmill Market – Food Hall", address: "1909 Bellamah Ave NW, Albuquerque, NM", distance: "2.8 mi", phone: "(505) 498-2982", hours: "Sun–Thu 8a–9p, Fri–Sat 8a–10p" },
      { area: "Old Town & Sawmill", name: "Mary & Tito’s Café – New Mexican", address: "2711 4th St NW, Albuquerque, NM", distance: "3.5 mi", phone: "(505) 344-6266", hours: "Tue–Sat 8a–8p" },

      // Quick Adventure (3–5 mi)
      { area: "Nob Hill & North Valley", name: "Frontier Restaurant – Diner", address: "2400 Central Ave SE, Albuquerque, NM", distance: "2.5 mi", phone: "(505) 266-0550", hours: "Daily 5a–12p" },
      { area: "Nob Hill & North Valley", name: "M’tucci’s Bar Roma – Italian", address: "3222 Central Ave SE, Albuquerque, NM", distance: "3.3 mi", phone: "(505) 508-2745", hours: "Sun–Thu 11a–9p, Fri–Sat 11a–10p" },
      { area: "Nob Hill & North Valley", name: "Annapurna’s Vegetarian Café – Vegetarian", address: "2201 Silver Ave SE, Albuquerque, NM", distance: "2.8 mi", phone: "(505) 262-2424", hours: "Daily 9a–8p" },
      { area: "Nob Hill & North Valley", name: "Guava Tree Café – Latin American", address: "118 Richmond Dr NE, Albuquerque, NM", distance: "3.0 mi", phone: "(505) 990-2599", hours: "Tue–Sat 11a–4p" },
      { area: "Nob Hill & North Valley", name: "O Ramen – Japanese/New Mexican Fusion", address: "2114 Central Ave SE, Albuquerque, NM", distance: "2.6 mi", phone: "(505) 369-1045", hours: "Mon–Sat 11a–9p, Sun 12p–8p" },
      { area: "Nob Hill & North Valley", name: "Tula’s Kitchen – American", address: "1825 Central Ave NW, Albuquerque, NM", distance: "4.0 mi", phone: "(505) 200-2666", hours: "Tue–Sun 9a–9p" },
      { area: "Nob Hill & North Valley", name: "El Pinto Restaurant & Cantina – New Mexican", address: "10500 4th St NW, Albuquerque, NM", distance: "4.8 mi", phone: "(505) 898-1771", hours: "Daily 11a–9p" },

      // Worth the Drive (5+ mi) — includes Farm & Table and Monte Carlo per your request
      { area: "Worth the Drive", name: "Farm & Table – Farm-to-Table", address: "8917 4th St NW, Albuquerque, NM", distance: "5.0 mi", phone: "(505) 503-7124", hours: "Wed–Sat 5p–9p, Sun 9a–2p" },
      { area: "Worth the Drive", name: "Monte Carlo Steakhouse – Steakhouse", address: "3916 Central Ave SW, Albuquerque, NM", distance: "2.2 mi", phone: "(505) 836-9886", hours: "Mon–Sat 11a–9p" },
      { area: "Worth the Drive", name: "Los Poblanos Campo Restaurant – Farm Dining", address: "4803 Rio Grande Blvd NW, Los Ranchos De Albuquerque, NM", distance: "6.2 mi", phone: "(505) 344-9297", hours: "Wed–Sun 5p–9p, Brunch Sat–Sun 9a–2p" },
      { area: "Worth the Drive", name: "Sadie’s of New Mexico – New Mexican", address: "6230 4th St NW, Albuquerque, NM", distance: "5.5 mi", phone: "(505) 345-5339", hours: "Daily 11a–9p" },
      { area: "Worth the Drive", name: "M’tucci’s Twenty-Five – Italian", address: "4939 Pan American Fwy NE, Albuquerque, NM", distance: "6.0 mi", phone: "(505) 312-8519", hours: "Daily 11a–10p" },
      { area: "Worth the Drive", name: "Nexus Brewery – Brewpub", address: "4730 Pan American Fwy NE, Albuquerque, NM", distance: "5.8 mi", phone: "(505) 458-5924", hours: "Daily 11a–9p" },
      { area: "Worth the Drive", name: "TEN3 at the Tram – American", address: "30 Tramway Rd NE, Albuquerque, NM", distance: "9.8 mi", phone: "(505) 856-6692", hours: "Mon–Thu 11a–9p, Fri–Sat 11a–9:30p, Sun 11a–8p" }
    ];

    // ====== Map Setup ======
    const map = L.map('map', { zoomControl: false, attributionControl: true }).setView([HOTEL.lat, HOTEL.lng], INITIAL_ZOOM);

    // Quiet light basemap
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      maxZoom: 20,
      attribution: '&copy; OpenStreetMap & CARTO'
    }).addTo(map);

    // Zoom control bottom-right
    L.control.zoom({ position: 'bottomright' }).addTo(map);

    // Hotel gold star
    const hotelIcon = L.divIcon({
      className: 'hotel-star', iconSize: [34, 34], iconAnchor: [17, 17], popupAnchor: [0, -12],
      html: '<svg width="34" height="34" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 2.5l2.9 5.9 6.5.9-4.7 4.6 1.1 6.4L12 17.8 6.2 20.3l1.1-6.4L2.6 9.3l6.5-.9L12 2.5z" fill="#FFD700" stroke="#B8860B" stroke-width="1"/></svg>'
    });
    const hotelMarker = L.marker([HOTEL.lat, HOTEL.lng], { icon: hotelIcon }).addTo(map)
      .bindPopup(`<div class="popup"><h4>${HOTEL.name}</h4><div class="meta">Hotel</div><div class="row"><strong>Lat/Lng</strong>${HOTEL.lat.toFixed(6)}, ${HOTEL.lng.toFixed(6)}</div></div>`);

    // ====== Geocoding ======
    const sleep = (ms)=>new Promise(r=>setTimeout(r, ms));
    const cacheKey = (addr)=>`geocode:${addr}`;
    async function geocode(addr){
      const key = cacheKey(addr);
      const cached = localStorage.getItem(key);
      if(cached){ try { return JSON.parse(cached); } catch(_){} }
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(addr)}`;
      const resp = await fetch(url, { headers: { 'Accept': 'application/json' } });
      const data = await resp.json();
      const best = data && data[0] ? { lat: parseFloat(data[0].lat), lng: parseFloat(data[0].lon) } : null;
      if(best){ localStorage.setItem(key, JSON.stringify(best)); }
      await sleep(250);
      return best;
    }

    // ====== Rendering ======
    const groups = {
      "Downtown": L.layerGroup().addTo(map),
      "Old Town & Sawmill": L.layerGroup().addTo(map),
      "Nob Hill & North Valley": L.layerGroup().addTo(map),
      "Worth the Drive": L.layerGroup().addTo(map)
    };
    const markersByName = new Map();

    function parseCuisine(name){
      const idx = name.indexOf('–');
      return idx > -1 ? name.slice(idx+1).trim() : 'Various';
    }

    function popupHtml(p){
      const digits = (p.phone||'').replace(/[^0-9]/g,'');
      const phoneRow = p.phone ? (digits ? `<div class="row"><strong>Phone</strong><a href="tel:${digits}">${p.phone}</a></div>` : `<div class="row"><strong>Phone</strong>${p.phone}</div>`) : '';
      const mapsQuery = encodeURIComponent(`${p.name} ${p.address}`);
      const appleUrl = `https://maps.apple.com/?q=${mapsQuery}`;
      const gmapsUrl = `https://www.google.com/maps/search/?api=1&query=${mapsQuery}`;
      return `<div class="popup">
        <h4>${p.name}</h4>
        <div class="meta">${p.area} • ${p.distance} • ${p.cuisine}</div>
        <div class="row"><strong>Address</strong>${p.address}</div>
        ${phoneRow}
        <div class="row"><strong>Hours</strong>${p.hours}</div>
        <div class="btns" style="margin-top:6px">
          <a class="btn" href="${appleUrl}" target="_blank" rel="noopener">Open in Apple Maps</a>
          <a class="btn" href="${gmapsUrl}" target="_blank" rel="noopener">Open in Google Maps</a>
        </div>
      </div>`;
    }

    async function addPlaces(){
      const sel = document.getElementById('placeSelect');
      const cuisineSel = document.getElementById('cuisineSelect');
      const byArea = {};
      const cuisines = new Set();

      PLACES.forEach(p=>{
        p.cuisine = parseCuisine(p.name);
        cuisines.add(p.cuisine);
        (byArea[p.area] ||= []).push(p);
      });

      // Build restaurant quick-jump
      Object.keys(byArea).forEach(area=>{
        const og = document.createElement('optgroup');
        og.label = area === 'Downtown' ? 'Walking Downtown (0–1 mi)'
                 : area === 'Old Town & Sawmill' ? 'Short Drive to Old Town (1–3 mi)'
                 : area === 'Nob Hill & North Valley' ? 'Quick Adventure (3–5 mi)'
                 : 'Worth the Drive (5+ mi)';
        byArea[area].forEach(p=>{
          const opt = document.createElement('option');
          opt.textContent = p.name;
          opt.value = p.name;
          og.appendChild(opt);
        });
        sel.appendChild(og);
      });

      // Cuisine filter
      Array.from(cuisines).sort().forEach(c=>{
        const opt = document.createElement('option');
        opt.textContent = c;
        opt.value = c;
        cuisineSel.appendChild(opt);
      });

      // Geocode and add markers
      const bounds = L.latLngBounds([ [HOTEL.lat, HOTEL.lng] ]);
      for(const p of PLACES){
        const coords = await geocode(p.address);
        if(!coords) continue;
        p.lat = coords.lat; p.lng = coords.lng;
        const color = COLORS[p.area] || '#333';
        const m = L.circleMarker([p.lat, p.lng], {
          radius: 7, color: color, weight: 1.25, fillColor: color, fillOpacity: 0.9
        }).bindPopup(popupHtml(p));
        m.options.cuisine = p.cuisine;
        m.addTo(groups[p.area]);
        markersByName.set(p.name, m);
        bounds.extend([p.lat, p.lng]);
      }
      map.fitBounds(bounds.pad(0.12));
    }

    addPlaces();

    // ====== UI Wiring ======
    document.getElementById('centerHotelBtn').addEventListener('click', ()=>{
      map.setView([HOTEL.lat, HOTEL.lng], INITIAL_ZOOM, { animate: true });
      hotelMarker.openPopup();
    });

    document.getElementById('useLocationBtn').addEventListener('click', ()=>{
      if(!navigator.geolocation){ alert('Geolocation not supported on this device.'); return; }
      navigator.geolocation.getCurrentPosition((pos)=>{
        const { latitude, longitude } = pos.coords;
        L.circleMarker([latitude, longitude], { radius: 7, color:'#0a84ff', weight:2, fillColor:'#0a84ff', fillOpacity:0.9 })
          .addTo(map).bindPopup('<div class="popup"><h4>You are here</h4></div>').openPopup();
        map.setView([latitude, longitude], 14, { animate: true });
      }, (err)=>{ alert('Unable to access location: ' + err.message); }, { enableHighAccuracy: true, timeout: 8000, maximumAge: 0 });
    });

    // Quick jump highlight
    document.getElementById('placeSelect').addEventListener('change', (e)=>{
      const m = markersByName.get(e.target.value); if(!m) return;
      map.setView(m.getLatLng(), 16, { animate: true });
      m.openPopup();
      const orig = m.options.radius; let step = 0; const id = setInterval(()=>{
        step++; m.setStyle({ radius: step % 2 ? orig + 4 : orig });
        if(step>6){ clearInterval(id); m.setStyle({ radius: orig }); }
      }, 160);
    });

    // Cuisine filter
    document.getElementById('cuisineSelect').addEventListener('change', (e)=>{
      const sel = e.target.value;
      markersByName.forEach((m)=>{
        if(!sel || m.options.cuisine === sel){ m.setStyle({ opacity: 1, fillOpacity: 0.9 }); }
        else { m.setStyle({ opacity: 0.15, fillOpacity: 0.15 }); }
      });
    });
  </script>
</body>
</html>
