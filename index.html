<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ABQ Dining Map</title>
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <style>
    :root{
      --bg:#f7f7f8; --panel:#fff; --text:#111418; --muted:#6b7280; --shadow:0 8px 30px rgba(0,0,0,.08); --radius:14px;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Inter,Roboto,Helvetica,Arial}
    #app{display:grid;grid-template-rows:auto 1fr;height:100vh}
    header{display:flex;align-items:center;gap:.6rem;padding:10px 14px;background:var(--panel);box-shadow:var(--shadow);position:sticky;top:0;z-index:1000}
    .title{font-weight:600}
    #map{height:100%}
    .controls{position:absolute;top:12px;right:12px;display:flex;flex-direction:column;gap:10px;z-index:1001}
    .card{background:var(--panel);border-radius:var(--radius);box-shadow:var(--shadow);padding:10px;min-width:260px;max-width:340px}
    .card h3{margin:0 0 8px 0;font-size:14px;font-weight:600}
    .legend-row{display:flex;align-items:center;gap:8px;font-size:13px;padding:6px 0}
    .chip{width:12px;height:12px;border-radius:50%;border:1px solid rgba(0,0,0,.1)}
    .select{width:100%;border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px;font-size:14px;background:#fafafa}
    .btns{display:flex;gap:8px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid #e5e7eb;background:#fff;border-radius:12px;padding:8px 12px;font-size:13px;cursor:pointer;box-shadow:var(--shadow)}
    .btn.primary{border-color:#dbeafe;background:#f0f7ff;color:#0b63d1}
    .leaflet-control-attribution{font-size:10px;color:var(--muted)}
    .popup h4{margin:0 0 6px 0;font-size:15px}
    .popup .meta{font-size:12px;color:var(--muted);margin-bottom:6px}
    .popup .row{font-size:13px;margin:2px 0}
    .popup .row strong{display:inline-block;width:72px;color:#374151}
    .hotel-star svg{filter:drop-shadow(0 2px 4px rgba(0,0,0,.25))}
  </style>
</head>
<body>
  <div id="app">
    <header>
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2c2.5 4.2 5.3 6.4 8.4 6.5-2.1 6.7-5.5 10.6-8.4 13-2.9-2.4-6.3-6.3-8.4-13C6.7 8.4 9.5 6.2 12 2Z" stroke="#0a84ff" stroke-width="1.2"/></svg>
      <div class="title">ABQ Dining Near DoubleTree</div>
    </header>

    <div style="position:relative;">
      <div id="map"></div>
      <div class="controls">
        <div class="card">
          <h3>Legend</h3>
          <div class="legend-row"><span class="chip" style="background:#5b93ff"></span> Walking Downtown (0–1 mi)</div>
          <div class="legend-row"><span class="chip" style="background:#8bd46a"></span> Short Drive to Old Town (1–3 mi)</div>
          <div class="legend-row"><span class="chip" style="background:#f3c96b"></span> Quick Adventure (3–5 mi)</div>
          <div class="legend-row"><span class="chip" style="background:#d89ef9"></span> Worth the Drive (5+ mi)</div>
          <div style="margin-top:8px">
            <select id="placeSelect" class="select">
              <option value="">Quick jump to a restaurant</option>
            </select>
          </div>
          <div class="btns" style="margin-top:8px">
            <button class="btn primary" id="centerHotelBtn">Center on Hotel</button>
            <button class="btn" id="useLocationBtn">Use My Location</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Config =====
    const HOTEL = { name: "DoubleTree by Hilton Downtown Albuquerque", lat: 35.088451, lng: -106.649013 };
    const INITIAL_ZOOM = 12; // per your request

    const COLORS = {
      "Walking Downtown": "#5b93ff",
      "Short Drive to Old Town": "#8bd46a",
      "Quick Adventure": "#f3c96b",
      "Worth the Drive": "#d89ef9"
    };

    // ===== Data (from your list) =====
    const PLACES = [
      // Walking Downtown (0–1 mi)
      { area: "Walking Downtown", name: "My Mom's - Breakfast", address: "500 4th St NW #106", distance: "0.1 mi", phone: "(505) 247-2943", hours: "Mon–Fri 8a-2p" },
      { area: "Walking Downtown", name: "CHAR (Hotel Andaluz) – American", address: "125 2nd St NW", distance: "0.2 mi", phone: "(505) 242-9080", hours: "Daily 7a–10p" },
      { area: "Walking Downtown", name: "Oni Ramen – Japanese/New Mexican Fusion", address: "600 Central Ave SW # 100", distance: "0.3 mi", phone: "(505) 503-6722", hours: "Daily 11:30a–8p" },
      { area: "Walking Downtown", name: "505 Central Food Hall – Food Hall", address: "505 Central Ave NW", distance: "0.3 mi", phone: "Varies by Vendor", hours: "Varies by Vendor | Usually 11a–9p" },
      { area: "Walking Downtown", name: "Slate Street Café – Café", address: "515 Slate Ave NW", distance: "0.4 mi", phone: "(505) 243-2210", hours: "Mon–Fri 8a–2p, Sat 9a–2p" },
      { area: "Walking Downtown", name: "Trackor Brewing Company Wells Park – Brewery", address: "1800 4th St NW", distance: "0.4 mi", phone: "(505) 243-6752", hours: "Mon 4–9p, Tue–Thu 2–10p, Fri 2p–12a, Sat 1–11p, Sun 1–10p" },
      { area: "Walking Downtown", name: "Range Café Downtown – New Mexican", address: "320 Central Ave SE", distance: "0.4 mi", phone: "(505) 243-1440", hours: "Daily 7a–3p" },
      { area: "Walking Downtown", name: "The Artichoke Café – American", address: "424 Central Ave SE", distance: "0.5 mi", phone: "(505) 243-0200", hours: "Mon–Thu 11a–9p, Fri–Sat 11a–10p" },
      { area: "Walking Downtown", name: "Marble Brewery – Brewery", address: "111 Marble Ave NW", distance: "0.5 mi", phone: "(505) 243-2739", hours: "Daily 11:30a–10p" },
      { area: "Walking Downtown", name: "Cocina Azul – New Mexican", address: "1134 Mountain Rd NW", distance: "0.7 mi", phone: "(505) 831-2500", hours: "Daily 9a–8p" },

      // Short Drive to Old Town (1–3 mi)
      { area: "Short Drive to Old Town", name: "Kosmos Restaurant & Astropub – American", address: "1715 5th St NW", distance: "1.2 mi", phone: "(505) 369-1772", hours: "Tue–Thu 11:30a–8p, Fri–Sat 11:30a–9p" },
      { area: "Short Drive to Old Town", name: "Laguna Burger (Old Town) – Burgers", address: "2400 12th St NW", distance: "2.0 mi", phone: "(505) 352-8282", hours: "Daily 10:30a–8p" },
      { area: "Short Drive to Old Town", name: "Indian Pueblo Kitchen – Native American", address: "2401 12th St NW", distance: "2.1 mi", phone: "(505) 724-3510", hours: "Wed–Sun 8a–3p" },
      { area: "Short Drive to Old Town", name: "Monte Carlo Steakhouse – Steakhouse", address: "3916 Central Ave SW", distance: "2.2 mi", phone: "(505) 836-9886", hours: "Mon–Sat 11a–9p" },
      { area: "Short Drive to Old Town", name: "66 Diner – Diner", address: "1405 Central Ave NE", distance: "2.3 mi", phone: "(505) 247-1421", hours: "Mon–Thu 11a–9p, Fri–Sat 11a–10p, Sun 11a–8p" },
      { area: "Short Drive to Old Town", name: "Frontier Restaurant – Diner", address: "2400 Central Ave SE", distance: "2.5 mi", phone: "(505) 266-0550", hours: "Daily 5a–12p" },
      { area: "Short Drive to Old Town", name: "Sawmill Market – Food Hall", address: "1909 Bellamah Ave NW", distance: "2.8 mi", phone: "(505) 498-2982", hours: "Sun–Thu 8a–9p, Fri–Sat 8a–10p" },
      { area: "Short Drive to Old Town", name: "Annapurna’s Vegetarian Café – Vegetarian", address: "2201 Silver Ave SE", distance: "2.8 mi", phone: "(505) 262-2424", hours: "Daily 9a–8p" },

      // Quick Adventure (3–5 mi)
      { area: "Quick Adventure", name: "M’tucci’s Bar Roma – Italian", address: "3222 Central Ave SE", distance: "3.3 mi", phone: "(505) 508-2745", hours: "Sun–Thu 11a–9p, Fri–Sat 11a–10p" },
      { area: "Quick Adventure", name: "Guava Tree Café – Latin American", address: "118 Richmond Dr NE", distance: "3.0 mi", phone: "(505) 990-2599", hours: "Tue–Sat 11a–4p" },
      { area: "Quick Adventure", name: "Tula’s Kitchen – American", address: "1825 Central Ave NW", distance: "4.0 mi", phone: "(505) 200-2666", hours: "Tue–Sun 9a–9p" },
      { area: "Quick Adventure", name: "El Pinto Restaurant & Cantina – New Mexican", address: "10500 4th St NW", distance: "4.8 mi", phone: "(505) 898-1771", hours: "Daily 11a–9p" },

      // Worth the Drive (5+ mi)
      { area: "Worth the Drive", name: "Farm & Table – Upscale Dining", address: "8917 4th St NW", distance: "5.0 mi", phone: "(505) 503-7124", hours: "Wed–Sat 5p–9p, Sun 9a–2p" },
      { area: "Worth the Drive", name: "Sadie’s of New Mexico – New Mexican", address: "6230 4th St NW", distance: "5.5 mi", phone: "(505) 345-5339", hours: "Daily 11a–9p" },
      { area: "Worth the Drive", name: "M’tucci’s – Italian", address: "4939 Pan American Fwy NE", distance: "6.0 mi", phone: "(505) 312-8519", hours: "Daily 11a–10p" },
      { area: "Worth the Drive", name: "Los Poblanos Campo Restaurant – Farm Dining", address: "4803 Rio Grande Blvd NW", distance: "6.2 mi", phone: "(505) 344-9297", hours: "Wed–Sun 5p–9p, Brunch Sat–Sun 9a–2p" },
      { area: "Worth the Drive", name: "Japanese Kitchen – Teppanyaki & Sushi", address: "6521 Americas Pkwy", distance: "6.2 mi", phone: "(505) 884-8937", hours: "Lunch Mon–Sat 11:30a–2:30p, Dinner Daily 5p–9p" },
      { area: "Worth the Drive", name: "TEN3 at Sandia Peak Tram – Upscale Dining", address: "30 Tramway Rd NE", distance: "9.8 mi", phone: "(505) 856-6692", hours: "Mon–Thu 11a–9p, Fri–Sat 11a–9:30p, Sun 11a–8p" }
    ];

    // ===== Map Setup =====
    const map = L.map('map', { zoomControl:false, attributionControl:true }).setView([HOTEL.lat, HOTEL.lng], INITIAL_ZOOM);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { maxZoom:20, attribution:'&copy; OpenStreetMap & CARTO' }).addTo(map);
    L.control.zoom({ position:'bottomright' }).addTo(map);

    // Hotel gold star
    const hotelIcon = L.divIcon({
      className:'hotel-star', iconSize:[34,34], iconAnchor:[17,17], popupAnchor:[0,-12],
      html:'<svg width="34" height="34" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 2.5l2.9 5.9 6.5.9-4.7 4.6 1.1 6.4L12 17.8 6.2 20.3l1.1-6.4L2.6 9.3l6.5-.9L12 2.5z" fill="#FFD700" stroke="#B8860B" stroke-width="1"/></svg>'
    });
    const hotelMarker = L.marker([HOTEL.lat, HOTEL.lng], { icon: hotelIcon }).addTo(map)
      .bindPopup(`<div class="popup"><h4>${HOTEL.name}</h4><div class="meta">Hotel</div><div class="row"><strong>Lat/Lng</strong>${HOTEL.lat.toFixed(6)}, ${HOTEL.lng.toFixed(6)}</div></div>`);

    // ===== Helpers =====
    const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
    const cacheKey = addr => `geocode:${addr}`;
    async function geocode(addr){
      const key = cacheKey(addr);
      const cached = localStorage.getItem(key);
      if(cached){ try{return JSON.parse(cached)}catch(_){}}
      const q = `${addr}, Albuquerque, NM`;
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}`;
      const resp = await fetch(url,{headers:{'Accept':'application/json'}});
      const data = await resp.json();
      const best = data && data[0] ? { lat: parseFloat(data[0].lat), lng: parseFloat(data[0].lon) } : null;
      if(best){ localStorage.setItem(key, JSON.stringify(best)); }
      await sleep(250);
      return best;
    }

    function popupHtml(p){
      const digits = (p.phone||'').replace(/[^0-9]/g,'');
      const phoneRow = p.phone ? (digits ? `<div class="row"><strong>Phone</strong><a href="tel:${digits}">${p.phone}</a></div>` : `<div class="row"><strong>Phone</strong>${p.phone}</div>`) : '';
      const mapsQuery = encodeURIComponent(`${p.name} ${p.address} Albuquerque NM`);
      const appleUrl = `https://maps.apple.com/?q=${mapsQuery}`;
      const gmapsUrl = `https://www.google.com/maps/search/?api=1&query=${mapsQuery}`;
      return `<div class="popup">
        <h4>${p.name}</h4>
        <div class="meta">${p.area} • ${p.distance}</div>
        <div class="row"><strong>Address</strong>${p.address}</div>
        ${phoneRow}
        <div class="row"><strong>Hours</strong>${p.hours}</div>
        <div class="btns" style="margin-top:6px">
          <a class="btn" href="${appleUrl}" target="_blank" rel="noopener">Open in Apple Maps</a>
          <a class="btn" href="${gmapsUrl}" target="_blank" rel="noopener">Open in Google Maps</a>
        </div>
      </div>`;
    }

    const groups = {
      "Walking Downtown": L.layerGroup().addTo(map),
      "Short Drive to Old Town": L.layerGroup().addTo(map),
      "Quick Adventure": L.layerGroup().addTo(map),
      "Worth the Drive": L.layerGroup().addTo(map)
    };

    const markersByName = new Map();

    async function addPlaces(){
      const sel = document.getElementById('placeSelect');
      const byArea = {};
      PLACES.forEach(p => { (byArea[p.area] ||= []).push(p); });

      // Build quick-jump grouped by area
      Object.keys(byArea).forEach(area => {
        const og = document.createElement('optgroup');
        og.label = area;
        byArea[area].forEach(p => {
          const opt = document.createElement('option');
          opt.textContent = p.name; opt.value = p.name; og.appendChild(opt);
        });
        sel.appendChild(og);
      });

      // Geocode and add markers
      const bounds = L.latLngBounds([ [HOTEL.lat, HOTEL.lng] ]);
      for(const p of PLACES){
        const coords = await geocode(p.address);
        if(!coords) continue;
        p.lat = coords.lat; p.lng = coords.lng;
        const color = COLORS[p.area] || '#333';
        const m = L.circleMarker([p.lat, p.lng], { radius:7, color:color, weight:1.25, fillColor:color, fillOpacity:0.9 })
          .bindPopup(popupHtml(p));
        m.addTo(groups[p.area]);
        markersByName.set(p.name, m);
        bounds.extend([p.lat, p.lng]);
      }
      map.fitBounds(bounds.pad(0.15));
    }

    addPlaces();

    // UI wiring
    document.getElementById('centerHotelBtn').addEventListener('click', ()=>{
      map.setView([HOTEL.lat, HOTEL.lng], INITIAL_ZOOM, { animate:true });
      hotelMarker.openPopup();
    });
    document.getElementById('useLocationBtn').addEventListener('click', ()=>{
      if(!navigator.geolocation){ alert('Geolocation not supported.'); return; }
      navigator.geolocation.getCurrentPosition((pos)=>{
        const { latitude, longitude } = pos.coords;
        L.circleMarker([latitude, longitude], { radius:7, color:'#0a84ff', weight:2, fillColor:'#0a84ff', fillOpacity:0.9 })
          .addTo(map).bindPopup('<div class="popup"><h4>You are here</h4></div>').openPopup();
        map.setView([latitude, longitude], 14, { animate:true });
      }, (err)=>{ alert('Unable to access location: ' + err.message); }, { enableHighAccuracy:true, timeout:8000, maximumAge:0 });
    });

    document.getElementById('placeSelect').addEventListener('change', (e)=>{
      const m = markersByName.get(e.target.value); if(!m) return;
      map.setView(m.getLatLng(), 16, { animate:true });
      m.openPopup();
      const orig = m.options.radius; let step = 0; const id = setInterval(()=>{
        step++; m.setStyle({ radius: step % 2 ? orig + 4 : orig });
        if(step>6){ clearInterval(id); m.setStyle({ radius: orig }); }
      }, 160);
    });
  </script>
</body>
</html>
